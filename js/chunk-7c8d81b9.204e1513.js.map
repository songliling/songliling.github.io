{"version":3,"sources":["webpack:///./src/views/manage/preview/index.vue?31c8","webpack:///./src/views/manage/preview/index.vue?b205","webpack:///./src/views/manage/preview/index.js","webpack:///./src/views/manage/preview","webpack:///./src/views/manage/preview/index.vue?d18a"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","_v","_s","projectId","detailData","projectName","on","onRun","onSaveScript","toCreateAtt","directives","name","rawName","value","expression","attrs","domProps","$event","target","composing","projectScript","ref","staticRenderFns","data","$route","params","scriptCount","computed","mapState","isReady","web3","ethersprovider","ethChainID","ethAddress","methods","getParams","tokenId","library","account","chainID","getProjectDetail","fetchProjectDetail","getProjectScript","fetchScriptInfo","code","fetchSaveProjectScript","scriptContent","scriptId","type","res","msg","$Notice","success","title","warning","nftDom","$refs","nftcanvas","childNodes","length","removeChild","tokenConfig","hashes","createIframe","dom","iframe","document","createElement","style","width","height","margin","padding","overflow","border","onload","Object","prototype","toString","call","attachEvent","addEventListener","srcdoc","JSON","stringify","appendChild","$router","push","watch","val","created","component"],"mappings":"kHAAA,W,gECAA,IAAIA,EAAS,WAAa,IAAIC,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAOE,EAAG,MAAM,CAACE,YAAY,0BAA0B,CAACF,EAAG,MAAM,CAACA,EAAG,MAAM,CAACJ,EAAIO,GAAG,eAAeP,EAAIQ,GAAGR,EAAIS,cAAcL,EAAG,MAAM,CAACJ,EAAIO,GAAG,iBAAiBP,EAAIQ,GAAGR,EAAIU,WAAWC,aAAa,OAAOP,EAAG,MAAM,CAACE,YAAY,aAAa,CAACF,EAAG,SAAS,CAACQ,GAAG,CAAC,MAAQZ,EAAIa,QAAQ,CAACb,EAAIO,GAAG,eAAeH,EAAG,SAAS,CAACE,YAAY,YAAYM,GAAG,CAAC,MAAQZ,EAAIc,eAAe,CAACd,EAAIO,GAAG,YAAYH,EAAG,SAAS,CAACE,YAAY,YAAYM,GAAG,CAAC,MAAQZ,EAAIe,cAAc,CAACf,EAAIO,GAAG,2BAA2BH,EAAG,MAAM,CAACA,EAAG,WAAW,CAACY,WAAW,CAAC,CAACC,KAAK,QAAQC,QAAQ,UAAUC,MAAOnB,EAAiB,cAAEoB,WAAW,kBAAkBC,MAAM,CAAC,KAAO,MAAMC,SAAS,CAAC,MAAStB,EAAiB,eAAGY,GAAG,CAAC,MAAQ,SAASW,GAAWA,EAAOC,OAAOC,YAAqBzB,EAAI0B,cAAcH,EAAOC,OAAOL,eAAcf,EAAG,MAAM,CAACE,YAAY,YAAY,CAACF,EAAG,MAAM,CAACE,YAAY,aAAa,CAACN,EAAIO,GAAG,YAAYH,EAAG,MAAM,CAACuB,IAAI,YAAYrB,YAAY,kBACl+BsB,EAAkB,G,kFCQP,GACXX,KAAM,UACNY,KAFW,WAGP,IAAQpB,EAAcR,KAAK6B,OAAOC,OAA1BtB,UACR,MAAO,CACHuB,YAAa,EACbN,cAAe,GACfjB,YACAC,WAAY,KAGpBuB,SAAU,iCACHC,eAAS,CAAC,OAAQ,iBAAkB,aAAc,gBADjD,IAEJC,QAFM,WAGF,OAAOlC,KAAKmC,MAAQnC,KAAKoC,gBAAkBpC,KAAKqC,YAAcrC,KAAKsC,cAG3EC,QAAS,CACLC,UADK,WAED,MAA+BxC,KAAK6B,OAAOC,OAAnCtB,EAAR,EAAQA,UAAWiC,EAAnB,EAAmBA,QACnB,MAAO,CACHN,KAAMnC,KAAKmC,KACXO,QAAS1C,KAAKoC,eACdO,QAAS3C,KAAKsC,WACdM,QAAS5C,KAAKqC,WACd7B,YACAiC,YAGFI,iBAZD,WAYoB,qKACff,EAAS,EAAKU,YADC,SAEGM,eAAmBhB,GAFtB,OAErB,EAAKrB,WAFgB,qDAInBsC,iBAhBD,WAgBoB,yKACfjB,EAAS,EAAKU,YADC,SAEEQ,eAAgBlB,GAFlB,gBAEbmB,EAFa,EAEbA,KACR,EAAKxB,cAAgBwB,EAHA,8CAenBpC,aA/BD,WA+BgB,uKACXiB,EAAS,EAAKU,YADH,SAECU,eAAuB,iCAClCpB,GADiC,IAEpCqB,cAAe,EAAK1B,cACpB2B,SAAU,EACVC,KAAM,SANO,OAEXC,EAFW,OAQD,OAAZA,EAAIC,IACN,EAAKC,QAAQC,QAAQ,CACnBC,MAAO,kBAGT,EAAKF,QAAQG,QAAQ,CACnBD,MAAO,eAdM,8CAyBrB9C,MAxDK,WA0DD,IAAMgD,EAAS5D,KAAK6D,MAAMC,UACpBrC,EAAgBzB,KAAKyB,cAEvBmC,EAAOG,WAAWC,QAAQJ,EAAOK,YAAYL,EAAOG,WAAW,IAEnE,IAAMG,EAAc,CAChBC,OAAQ,CAAC,sEACT1B,QAAS,GAGbzC,KAAKoE,aAAaR,EAAQM,EAAazC,IAE3C2C,aAtEK,SAsEQC,EAAKH,EAAazC,GAC3B,IAAM6C,EAASC,SAASC,cAAc,UAwCtC,OArCAF,EAAOG,MAAMC,MAAQ,OACrBJ,EAAOG,MAAME,OAAS,OACtBL,EAAOG,MAAMG,OAAS,IACtBN,EAAOG,MAAMI,QAAU,IACvBP,EAAOG,MAAMK,SAAW,SACxBR,EAAOG,MAAMM,OAAS,OAElBC,QAAqD,sBAA3CC,OAAOC,UAAUC,SAASC,KAAKJ,UACrCV,EAAOe,YACPf,EAAOe,YAAY,SAAUL,QACtBV,EAAOgB,iBACdhB,EAAOgB,iBAAiB,OAAQN,QAEhCV,EAAOU,OAASA,QAIxBV,EAAOiB,OAAS,mJAEiBC,KAAKC,UAAUvB,GAFhC,qBAGCzC,EAHD,yOAkBhB4C,EAAIqB,YAAYpB,GAETA,GAEXxD,YAjHK,WAkHDd,KAAK2F,QAAQC,KAAb,sBAAiC5F,KAAKQ,cAG9CqF,MAAO,CACH3D,QADG,SACK4D,GACAA,IACA9F,KAAK6C,mBACL7C,KAAK+C,sBAIjBgD,QA9IW,WA+IH/F,KAAKkC,UACLlC,KAAK6C,mBACL7C,KAAK+C,sBC1JqR,I,wBCQlSiD,EAAY,eACd,EACAlG,EACA6B,GACA,EACA,KACA,WACA,MAIa,aAAAqE,E","file":"js/chunk-7c8d81b9.204e1513.js","sourcesContent":["export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./index.vue?vue&type=style&index=0&id=3b919b02&lang=less&scoped=true&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"nft-script grid-2 pt-8\"},[_c('div',[_c('div',[_vm._v(\"Project ID: \"+_vm._s(_vm.projectId))]),_c('div',[_vm._v(\"Project Name: \"+_vm._s(_vm.detailData.projectName)+\" \")]),_c('div',{staticClass:\"mrg-tb-20\"},[_c('button',{on:{\"click\":_vm.onRun}},[_vm._v(\" Preview \")]),_c('button',{staticClass:\"mrg-lr-20\",on:{\"click\":_vm.onSaveScript}},[_vm._v(\" Save \")]),_c('button',{staticClass:\"mrg-lr-20\",on:{\"click\":_vm.toCreateAtt}},[_vm._v(\" Create Attributes \")])]),_c('div',[_c('textarea',{directives:[{name:\"model\",rawName:\"v-model\",value:(_vm.projectScript),expression:\"projectScript\"}],attrs:{\"rows\":\"20\"},domProps:{\"value\":(_vm.projectScript)},on:{\"input\":function($event){if($event.target.composing){ return; }_vm.projectScript=$event.target.value}}})])]),_c('div',{staticClass:\"art-show\"},[_c('div',{staticClass:\"mrg-tb-20\"},[_vm._v(\" Show \")]),_c('div',{ref:\"nftcanvas\",staticClass:\"art-show\"})])])}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import { mapState } from 'vuex';\nimport event from '@/common/utils/event.js';\nimport {\n    fetchSaveProjectScript,\n    fetchProjectScript,\n    fetchScriptInfo,\n    fetchProjectDetail\n} from '../../../contactLogic/manage';\n\nexport default {\n    name: 'artList',\n    data() {\n        const { projectId } = this.$route.params;\n        return {\n            scriptCount: 0,\n            projectScript: '',\n            projectId,\n            detailData: {},\n        };\n    },\n    computed: {\n        ...mapState(['web3', 'ethersprovider', 'ethChainID', 'ethAddress']),\n        isReady() {\n            return this.web3 && this.ethersprovider && this.ethChainID && this.ethAddress;\n        },\n    },\n    methods: {\n        getParams() {\n            const { projectId, tokenId } = this.$route.params;\n            return {\n                web3: this.web3,\n                library: this.ethersprovider,\n                account: this.ethAddress,\n                chainID: this.ethChainID,\n                projectId,\n                tokenId,\n            };\n        },\n        async getProjectDetail() {\n            const params = this.getParams();\n            this.detailData = await fetchProjectDetail(params);\n        },\n        async getProjectScript() {\n            const params = this.getParams();\n            const { code } = await fetchScriptInfo(params);\n            this.projectScript = code;\n\n            // const scriptInfo = await fetchScriptInfo(params);\n            // this.scriptCount = scriptInfo[1] && scriptInfo[1].toString();\n            // console.log(scriptInfo, this.scriptCount, 3333);\n            // if (this.scriptCount) {\n            //     this.projectScript = await fetchProjectScript({\n            //         ...params,\n            //         index: 0,\n            //     });\n            // }\n        },\n        async onSaveScript() {\n            const params = this.getParams();\n            const res = await fetchSaveProjectScript({\n                ...params,\n                scriptContent: this.projectScript,\n                scriptId: 0, //this.scriptCount-1,\n                type: 'add' // this.scriptCount > 0 ? 'update' : 'add',\n            });\n            if (res.msg === 'ok') {\n              this.$Notice.success({\n                title: 'Save Success！',\n              });\n            } else {\n              this.$Notice.warning({\n                title: 'Save Fail！',\n              });\n            }\n            // event.$emit('sendtx', [\n            //     res,\n            //     {\n            //         okinfo: `Success!`,\n            //         failinfo: `Failed！`,\n            //     },\n            // ]);\n        },\n        onRun() {\n            // const { params } = this.$route;\n            const nftDom = this.$refs.nftcanvas;\n            const projectScript = this.projectScript;\n\n            if (nftDom.childNodes.length) nftDom.removeChild(nftDom.childNodes[0]);\n\n            const tokenConfig = {\n                hashes: ['0x722899b10c66da3b72fb60a8e71df442ee1c004547ba2227d76bed357469b4ea'],\n                tokenId: 1,\n            };\n\n            this.createIframe(nftDom, tokenConfig, projectScript);\n        },\n        createIframe(dom, tokenConfig, projectScript) {\n            const iframe = document.createElement(\"iframe\");\n\n            //设置iframe的样式\n            iframe.style.width = \"100%\";\n            iframe.style.height = \"100%\";\n            iframe.style.margin = \"0\";\n            iframe.style.padding = \"0\";\n            iframe.style.overflow = \"hidden\";\n            iframe.style.border = \"none\";\n\n            if (onload && Object.prototype.toString.call(onload) === \"[object Function]\") {\n                if (iframe.attachEvent) {\n                    iframe.attachEvent(\"onload\", onload);\n                } else if (iframe.addEventListener) {\n                    iframe.addEventListener(\"load\", onload);\n                } else {\n                    iframe.onload = onload;\n                }\n            }\n\n            iframe.srcdoc = '<html><head><meta charset=\"utf-8\"/><script src=\"https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.0.0/p5.min.js\"></script>' +\n\n                '<script>let tokenData = ' + JSON.stringify(tokenConfig) + '</script>' +\n                '<script>' + projectScript + '</script><style type=\"text/css\">body {\\n' +\n                '  margin: 0;\\n' +\n                '  padding: 0;\\n' +\n                '}\\n' +\n                'canvas {\\n' +\n                '  padding: 0;\\n' +\n                '  margin: auto;\\n' +\n                '  display: block;\\n' +\n                '  position: absolute;\\n' +\n                '  top: 0;\\n' +\n                '  bottom: 0;\\n' +\n                '  left: 0;\\n' +\n                '  right: 0;\\n' +\n                '}</style></head></html>';\n\n            dom.appendChild(iframe);\n\n            return iframe;\n        },\n        toCreateAtt() {\n            this.$router.push(`/createAttr/${this.projectId}`);\n        }\n    },\n    watch: {\n        isReady(val) {\n            if (val) {\n                this.getProjectDetail();\n                this.getProjectScript();\n            }\n        }\n    },\n    created() {\n        if (this.isReady) {\n            this.getProjectDetail();\n            this.getProjectScript();\n        }\n    }\n};\n","import mod from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/eslint-loader/index.js??ref--13-0!./index.js?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../../../node_modules/thread-loader/dist/cjs.js!../../../../node_modules/babel-loader/lib/index.js!../../../../node_modules/eslint-loader/index.js??ref--13-0!./index.js?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./index.vue?vue&type=template&id=3b919b02&scoped=true&\"\nimport script from \"./index.js?vue&type=script&lang=js&\"\nexport * from \"./index.js?vue&type=script&lang=js&\"\nimport style0 from \"./index.vue?vue&type=style&index=0&id=3b919b02&lang=less&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"3b919b02\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}